version: 2
jobs:
  build:
    docker:
      - image: continuumio/miniconda3
    environment:
      PYTHONHASHSEED: 0
      OMP_NUM_THREADS: 1
      PYEMMA_NJOBS: 1

#dependencies:
#  cache_directories:
#    - $HOME/miniconda/

#checkout:
#  post:
#    - git fetch --unshallow || true

  steps:
    - checkout
    - run: |
      conda config --add channels conda-forge
      conda config --set always_yes true
    - run: conda env create -f environment.yml
    - run: conda install -n pyemma_tutorial nbval
    - run: pytest --nbval -v notebooks/ 

